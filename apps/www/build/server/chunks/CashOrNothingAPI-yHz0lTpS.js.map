{"version":3,"file":"CashOrNothingAPI-yHz0lTpS.js","sources":["../../../../src/routes/playground/options-api/components/CashOrNothingAPI.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { Button } from '$lib/components/ui/button';\n  import { Input } from '$lib/components/ui/input';\n  import { Label } from '$lib/components/ui/label';\n  import { formatOutputDate, formatTime } from '$lib/utils';\n  import { createCashOrNothingOption } from '$lib/wrappers';\n  import { Address, fromNano } from '@ton/core';\n  import clsx from 'clsx';\n  import { toast } from 'svelte-sonner';\n  import { derived, writable } from 'svelte/store';\n  import Output from '../../components/Output.svelte';\n  import Section from './Section.svelte';\n\n  const streamAddress = writable('');\n  const option = createCashOrNothingOption(streamAddress);\n\n  const shouldDisableActions = derived([streamAddress], ([$streamAddress]) => !$streamAddress);\n\n  let output = $state<{ date: string; message: string }[]>([]);\n\n  function formatOutput(input: {\n    type: 'coins' | 'object' | 'address' | 'timestamp' | 'other';\n    value: bigint | object | Address | null;\n  }) {\n    if (input.value === null) {\n      return 'Empty response.';\n    }\n\n    if (input.type === 'coins') {\n      return fromNano(input.value as bigint).toString();\n    }\n\n    if (input.type === 'timestamp') {\n      return formatTime(new Date(Number(input.value) * 1000));\n    }\n\n    if (input.type === 'object') {\n      return JSON.stringify(\n        input.value,\n        (_, v) => {\n          if (v instanceof Address) {\n            return v.toString({ testOnly: true, bounceable: false });\n          }\n\n          if (typeof v === 'bigint') {\n            return v.toString();\n          }\n\n          return v;\n        },\n        2\n      );\n    }\n\n    if (input.type === 'address') {\n      return (input.value as Address).toString({\n        testOnly: true,\n        bounceable: false\n      });\n    }\n\n    return input.value.toString();\n  }\n\n  function postToOutput(message: string) {\n    output.unshift({ date: formatOutputDate(new Date()), message });\n  }\n</script>\n\n<Section title=\"Cash-or-Nothing Option\">\n  <div class=\"grid gap-3 mt-4\">\n    <Label class=\"grid gap-2\">\n      Stream Address\n      <Input\n        type=\"text\"\n        name=\"streamAddress\"\n        placeholder=\"0QDCiYqpPo9esMDX35_BWYcsR1NKS7lbnPcPF6IMH8MNx2Lj\"\n        required\n        class=\"w-fit\"\n        bind:value={$streamAddress}\n      />\n    </Label>\n  </div>\n  <p class=\"mt-3 mb-8 text-ds-gray-900 max-w-[640px]\">\n    This smart contract manages \"cash-or-nothing\" options. It handles deployment, validates\n    agreements, monitors market data, and determines if an option is \"in,\" \"out,\" or \"at\" the money\n    at expiration, sending notifications and payouts accordingly.\n  </p>\n\n  <div class=\"flex mt-8 gap-4 items-end overflow-x-auto pb-6 snap-x snap-mandatory\">\n    <a\n      class={clsx('snap-start', $shouldDisableActions && 'cursor-not-allowed')}\n      href={$shouldDisableActions\n        ? undefined\n        : `/playground/options-api/deploy?contract=option&title=${encodeURIComponent('Cash-or-Nothing Option')}&subtitle=option&stream=${$streamAddress}`}\n    >\n      <Button\n        class=\"bg-ds-teal-800 hover:bg-ds-teal-700 text-white\"\n        disabled={$shouldDisableActions}>Deploy Option</Button\n      >\n    </a>\n\n    <!-- TODO: Allow the user to provide queryId -->\n    <Button\n      class=\"bg-ds-teal-800 hover:bg-ds-teal-700 text-white snap-start\"\n      disabled={$shouldDisableActions}\n      onclick={async () => await $option.checkTimeout({ queryId: BigInt(Date.now()) })}\n      >Check Timeout</Button\n    >\n\n    <Button\n      class=\"bg-ds-blue-800 hover:bg-ds-blue-700 snap-start text-white\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        try {\n          const result = await $option.getOptionId();\n          postToOutput(\n            formatOutput({\n              type: 'other',\n              value: result\n            })\n          );\n        } catch (error) {\n          toast.error('Option has not been deployed or it has expired.');\n        }\n      }}\n    >\n      Get Option ID\n    </Button>\n\n    <Button\n      class=\"bg-ds-blue-800 hover:bg-ds-blue-700 snap-start text-white\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        try {\n          const result = await $option.getAgreement();\n          postToOutput(\n            formatOutput({\n              type: 'object',\n              value: result\n            })\n          );\n        } catch (error) {\n          toast.error('Option has not been deployed or it has expired.');\n        }\n      }}\n    >\n      Get Agreement\n    </Button>\n\n    <Button\n      class=\"bg-ds-blue-800 hover:bg-ds-blue-700 snap-start text-white\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        try {\n          const result = await $option.getStrikePrice();\n          postToOutput(\n            formatOutput({\n              type: 'other',\n              value: result\n            })\n          );\n        } catch (error) {\n          toast.error('Option has not been deployed or it has expired.');\n        }\n      }}\n    >\n      Get Strike Price\n    </Button>\n\n    <Button\n      class=\"bg-ds-blue-800 hover:bg-ds-blue-700 snap-start text-white\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        try {\n          const result = await $option.getLatestCandlestick();\n          postToOutput(\n            formatOutput({\n              type: 'object',\n              value: result\n            })\n          );\n        } catch (error) {\n          toast.error('Option has not been deployed or it has expired.');\n        }\n      }}\n    >\n      Get Latest Candlestick\n    </Button>\n\n    <Button\n      class=\"bg-ds-blue-800 hover:bg-ds-blue-700 snap-start text-white\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        try {\n          const result = await $option.getExpiration();\n          postToOutput(\n            formatOutput({\n              type: 'timestamp',\n              value: result\n            })\n          );\n        } catch (error) {\n          toast.error('Option has not been deployed or it has expired.');\n        }\n      }}\n    >\n      Get Expiration\n    </Button>\n\n    <Button\n      class=\"bg-ds-blue-800 hover:bg-ds-blue-700 snap-start text-white\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        try {\n          const result = await $option.getBalance();\n          postToOutput(\n            formatOutput({\n              type: 'coins',\n              value: result\n            })\n          );\n        } catch (error) {\n          toast.error('Option has not been deployed or it has expired.');\n        }\n      }}\n    >\n      Get Balance\n    </Button>\n\n    <Button\n      class=\"bg-ds-blue-800 hover:bg-ds-blue-700 snap-start text-white\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        try {\n          const result = await $option.getDeployerAddress();\n          postToOutput(\n            formatOutput({\n              type: 'address',\n              value: result\n            })\n          );\n        } catch (error) {\n          toast.error('Option has not been deployed or it has expired.');\n        }\n      }}\n    >\n      Get Deployer Address\n    </Button>\n\n    <Button\n      class=\"bg-ds-blue-800 hover:bg-ds-blue-700 snap-start text-white\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        try {\n          const result = await $option.getStreamAddress();\n          postToOutput(\n            formatOutput({\n              type: 'address',\n              value: result\n            })\n          );\n        } catch (error) {\n          toast.error('Option has not been deployed or it has expired.');\n        }\n      }}\n    >\n      Get Stream Address\n    </Button>\n\n    <Button\n      class=\"bg-ds-blue-800 hover:bg-ds-blue-700 snap-start text-white\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        try {\n          const result = await $option.getSessionAddress();\n          postToOutput(\n            formatOutput({\n              type: 'address',\n              value: result\n            })\n          );\n        } catch (error) {\n          toast.error('Option has not been deployed or it has expired.');\n        }\n      }}\n    >\n      Get Session Address\n    </Button>\n\n    <Button\n      class=\"bg-ds-blue-800 hover:bg-ds-blue-700 snap-start text-white\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        try {\n          const result = await $option.getNotificationsCount();\n          postToOutput(\n            formatOutput({\n              type: 'other',\n              value: result\n            })\n          );\n        } catch (error) {\n          toast.error('Option has not been deployed or it has expired.');\n        }\n      }}\n    >\n      Get Notifications Count\n    </Button>\n  </div>\n\n  <Output bind:output />\n</Section>\n"],"names":["$.store_get"],"mappings":"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"}