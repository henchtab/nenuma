{"version":3,"file":"SessionAPI-DY5K9BhH.js","sources":["../../../../src/routes/playground/streams-api/components/SessionAPI.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { Button } from '$lib/components/ui/button';\n  import { Input } from '$lib/components/ui/input';\n  import { Label } from '$lib/components/ui/label';\n  import { formatOutputDate } from '$lib/utils';\n  import { useSession } from '$lib/wrappers';\n  import { fromNano } from '@ton/core';\n  import { writable } from 'svelte/store';\n  import Output from '../../components/Output.svelte';\n  import Section from './Section.svelte';\n\n  const subscriberAddress = writable('');\n  const session = useSession(subscriberAddress);\n\n  let output = $state<{ date: string; message: string }[]>([]);\n\n  async function handleSessionSubscriptionSubmit(\n    e: SubmitEvent & {\n      currentTarget: EventTarget & HTMLFormElement;\n    }\n  ) {\n    e.preventDefault();\n    const formData = new FormData(e.currentTarget);\n\n    const args = {\n      notificationsCount: BigInt(formData.get('notificationsCount') as string),\n      queryId: BigInt(formData.get('queryId') as string)\n    };\n\n    await $session.subscribe(args);\n  }\n\n  async function handleSessionUnsubscriptionSubmit(\n    e: SubmitEvent & {\n      currentTarget: EventTarget & HTMLFormElement;\n    }\n  ) {\n    e.preventDefault();\n    const formData = new FormData(e.currentTarget);\n\n    const args = {\n      queryId: BigInt(formData.get('queryId') as string)\n    };\n\n    await $session.unsubscribe(args);\n  }\n\n  async function handleSessionDestroySubmit(\n    e: SubmitEvent & {\n      currentTarget: EventTarget & HTMLFormElement;\n    }\n  ) {\n    e.preventDefault();\n    const formData = new FormData(e.currentTarget);\n\n    const args = {\n      queryId: BigInt(formData.get('queryId') as string)\n    };\n\n    await $session.destroy(args);\n  }\n</script>\n\n<Section title=\"Session\">\n  <Label class=\"grid gap-2 mt-4\">\n    Subscriber Address\n    <Input\n      type=\"text\"\n      name=\"subscriberAddress\"\n      placeholder=\"0QDCiYqpPo9esMDX35_BWYcsR1NKS7lbnPcPF6IMH8MNx2Lj\"\n      required\n      class=\"w-fit\"\n      bind:value={$subscriberAddress}\n    />\n  </Label>\n  <p class=\"mt-3 mb-8 text-ds-gray-900 max-w-[640px]\">\n    The Session contract handles individual subscriptions in a data stream system on the blockchain.\n    It manages subscriber info, deposits, and notifications. Key features include: Deploying\n    sessions Managing subscriptions (starting, topping up, unsubscribing) Forwarding data\n    notifications (like candlesticks) Handling deposits for various actions This contract ensures\n    subscribers get the data they signed up for and manages the lifecycle of a subscription\n    efficiently. <br /> <br /> For more details, you can explore the\n    <a\n      class=\"underline\"\n      href=\"https://github.com/dreamqip/nenuma/blob/main/contracts/contracts/session.tact\"\n      target=\"_blank\">contract code</a\n    > and its functionality.\n  </p>\n\n  <div class=\"flex mt-8 gap-4 items-end overflow-x-auto pb-6 snap-x snap-mandatory\">\n    <form\n      class=\"flex snap-start flex-col gap-4 min-w-max\"\n      onsubmit={handleSessionSubscriptionSubmit}\n    >\n      <Label class=\"flex flex-col gap-2\"\n        >Notifications Count\n        <Input type=\"number\" name=\"notificationsCount\" placeholder=\"4\" required min=\"1\" />\n      </Label>\n      <Label class=\"flex flex-col gap-2\"\n        >Query ID\n        <Input type=\"number\" name=\"queryId\" placeholder=\"777\" required min=\"0\" />\n      </Label>\n      <Button class=\"bg-ds-teal-800 text-white hover:bg-ds-teal-700\" type=\"submit\">Subscribe</Button\n      >\n    </form>\n\n    <form\n      class=\"flex snap-start flex-col gap-4 min-w-max\"\n      onsubmit={handleSessionUnsubscriptionSubmit}\n    >\n      <Label class=\"flex flex-col gap-2\"\n        >Query ID\n        <Input type=\"number\" name=\"queryId\" placeholder=\"777\" required min=\"0\" />\n      </Label>\n      <Button class=\"bg-ds-teal-800 text-white hover:bg-ds-teal-700\" type=\"submit\"\n        >Unsubscribe</Button\n      >\n    </form>\n\n    <form class=\"flex snap-start flex-col gap-4 min-w-max\" onsubmit={handleSessionDestroySubmit}>\n      <Label class=\"flex flex-col gap-2\"\n        >Query ID\n        <Input type=\"number\" name=\"queryId\" placeholder=\"777\" required min=\"0\" />\n      </Label>\n      <Button class=\"bg-ds-teal-800 text-white hover:bg-ds-teal-700\" type=\"submit\">Destroy</Button>\n    </form>\n\n    <Button\n      class=\"bg-ds-pink-800 snap-start text-white hover:bg-ds-pink-700\"\n      onclick={async () => {\n        const result = await $session.getStreamAddress();\n        output.unshift({\n          date: formatOutputDate(new Date()),\n          message: JSON.stringify(result.toString({ testOnly: true, bounceable: false }), null, 2)\n        });\n      }}>Get Stream Address</Button\n    >\n\n    <Button\n      class=\"bg-ds-pink-800 snap-start text-white hover:bg-ds-pink-700\"\n      onclick={async () => {\n        const result = await $session.getBalance();\n\n        output.unshift({\n          date: formatOutputDate(new Date()),\n          message: JSON.stringify(`${fromNano(result)} TON`, null, 2)\n        });\n      }}>Get Balance</Button\n    >\n\n    <Button\n      class=\"bg-ds-pink-800 snap-start text-white hover:bg-ds-pink-700\"\n      onclick={async () => {\n        const result = await $session.getBatchAddress();\n\n        if (!result) {\n          output.unshift({\n            date: formatOutputDate(new Date()),\n            message: 'No batch address found'\n          });\n          return;\n        }\n\n        output.unshift({\n          date: formatOutputDate(new Date()),\n          message: JSON.stringify(result.toString({ testOnly: true, bounceable: false }), null, 2)\n        });\n      }}>Get Batch Address</Button\n    >\n\n    <Button\n      class=\"bg-ds-pink-800 text-white snap-start hover:bg-ds-pink-700\"\n      onclick={async () => {\n        const result = await $session.getSubscriberAddress();\n\n        output.unshift({\n          date: formatOutputDate(new Date()),\n          message: JSON.stringify(result.toString({ testOnly: true, bounceable: false }), null, 2)\n        });\n      }}>Get Subscriber Address</Button\n    >\n  </div>\n\n  <Output bind:output />\n</Section>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAWQ,EAAR,MAAQ,iBAAR,GAA4B,QAA5B,CAAqC,EAAE,CAAvC,CAAA;AACQ,EAAR,MAAQ,OAAR,GAAkB,UAAlB,CAA6B,iBAAiB,CAA9C,CAAA;AAEM,EAAN,IAAM,MAAN,GAAM,EAAN,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoHc,YAAd,MAAc,MAAd,GAAA,MAAA,SAAA,CAAA,YAAA,KAAA,EAAA,EAAA,UAAA,EAAA,OAAA,CAAA,CAAsC,gBAAtC,EAAA,CAAA;AACQ,YAAR,MAAA,CAAe,OAAf,CAAsB;AAAA,cACZ,IADV,EACgB,gBADhB,iBAAA,IACqC,IADrC,EACyC,CADzC;AACyC,cAC/B,OADV,EACmB,IADnB,CACwB,SADxB,CACkC,MADlC,CACyC,QADzC,CACiD,EAAG,QADpD,EAC8D,IAD9D,EACoE,UADpE,EACgF,KADhF,EAC0F,CAD1F,EAC0F,IAD1F,EACgG,CAAC,CADjG;AACiG,aAAjG,CAAA,CAAA;;;;;;;;;;;AAQc,YAAd,MAAc,MAAd,GAAA,MAAA,SAAA,CAAA,YAAA,KAAA,EAAA,EAAA,UAAA,EAAA,OAAA,CAAA,CAAsC,UAAtC,EAAA,CAAA;AAEQ,YAAR,MAAA,CAAe,OAAf,CAAsB;AAAA,cACZ,IADV,EACgB,gBADhB,iBAAA,IACqC,IADrC,EACyC,CADzC;AACyC,cAC/B,OADV,EACmB,IADnB,CACwB,SADxB,CACiC,CADjC,EACqC,QADrC,CAC8C,MAAM,CAAA,CADpD,IAAA,CAAA,EAC6D,IAD7D,EACmE,CAAC,CADpE;AACoE,aAApE,CAAA,CAAA;;;;;;;;;;;AAQc,YAAd,MAAc,MAAd,GAAA,MAAA,SAAA,CAAA,YAAA,KAAA,EAAA,EAAA,UAAA,EAAA,OAAA,CAAA,CAAsC,eAAtC,EAAA,CAAA;AAEA,YAAA,IAAA,CAAa,MAAb,EAAmB;AACT,cAAV,MAAA,CAAiB,OAAjB,CAAwB;AAAA,gBACZ,IADZ,EACkB,gBADlB,iBAAA,IACuC,IADvC,EAC2C,CAD3C;AAC2C,gBAC/B,OADZ,EACqB,wBADrB;AACqB,eAArB,CAAA,CAAA;;;AAKQ,YAAR,MAAA,CAAe,OAAf,CAAsB;AAAA,cACZ,IADV,EACgB,gBADhB,iBAAA,IACqC,IADrC,EACyC,CADzC;AACyC,cAC/B,OADV,EACmB,IADnB,CACwB,SADxB,CACkC,MADlC,CACyC,QADzC,CACiD,EAAG,QADpD,EAC8D,IAD9D,EACoE,UADpE,EACgF,KADhF,EAC0F,CAD1F,EAC0F,IAD1F,EACgG,CAAC,CADjG;AACiG,aAAjG,CAAA,CAAA;;;;;;;;;;;AAQc,YAAd,MAAc,MAAd,GAAA,MAAA,SAAA,CAAA,YAAA,KAAA,EAAA,EAAA,UAAA,EAAA,OAAA,CAAA,CAAsC,oBAAtC,EAAA,CAAA;AAEQ,YAAR,MAAA,CAAe,OAAf,CAAsB;AAAA,cACZ,IADV,EACgB,gBADhB,iBAAA,IACqC,IADrC,EACyC,CADzC;AACyC,cAC/B,OADV,EACmB,IADnB,CACwB,SADxB,CACkC,MADlC,CACyC,QADzC,CACiD,EAAG,QADpD,EAC8D,IAD9D,EACoE,UADpE,EACgF,KADhF,EAC0F,CAD1F,EAC0F,IAD1F,EACgG,CAAC,CADjG;AACiG,aAAjG,CAAA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}