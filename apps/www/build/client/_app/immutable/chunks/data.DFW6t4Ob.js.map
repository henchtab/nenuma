{"version":3,"file":"data.DFW6t4Ob.js","sources":["../../../../../../../../node_modules/.pnpm/js-cookie@3.0.5/node_modules/js-cookie/dist/js.cookie.mjs","../../../../../../src/lib/data.ts"],"sourcesContent":["/*! js-cookie v3.0.5 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (name, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    name = encodeURIComponent(name)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      name + '=' + converter.write(value, name) + stringifiedAttributes)\n  }\n\n  function get (name) {\n    if (typeof document === 'undefined' || (arguments.length && !name)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var found = decodeURIComponent(parts[0]);\n        jar[found] = converter.read(value, found);\n\n        if (name === found) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return name ? jar[name] : jar\n  }\n\n  return Object.create(\n    {\n      set,\n      get,\n      remove: function (name, attributes) {\n        set(\n          name,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport { api as default };\n","import { PUBLIC_API_URL } from '$env/static/public';\nimport type { Account, ConnectAdditionalRequest, TonProofItemReplySuccess } from '@tonconnect/ui';\nimport cookie from 'js-cookie';\nimport { ACCESS_TOKEN_COOKIE, COOKIE_EXPIRES } from './constants';\n\n/**\n * Generate a new proof payload\n *\n * @returns {Promise<ConnectAdditionalRequest | null>}\n */\nexport async function generatePayload(): Promise<ConnectAdditionalRequest | null> {\n  try {\n    const response = await (\n      await fetch(`${PUBLIC_API_URL}/api/generate-proof-payload`, {\n        method: 'POST'\n      })\n    ).json();\n    return { tonProof: response.proofToken as string };\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Check the proof\n *\n * @param {TonProofItemReplySuccess['proof']} proof\n * @param {Account} account\n \n * @returns {Promise<void>}\n */\nexport async function checkProof(\n  proof: TonProofItemReplySuccess['proof'],\n  account: Account\n): Promise<void> {\n  try {\n    const reqBody = {\n      address: account.address,\n      network: account.chain,\n      public_key: account.publicKey,\n      proof: {\n        ...proof,\n        state_init: account.walletStateInit\n      }\n    };\n\n    const response = await (\n      await fetch(`${PUBLIC_API_URL}/api/check-proof`, {\n        method: 'POST',\n        body: JSON.stringify(reqBody),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      })\n    ).json();\n\n    if (response?.token) {\n      cookie.set(ACCESS_TOKEN_COOKIE, response.token, {\n        expires: COOKIE_EXPIRES,\n        sameSite: 'Lax'\n      });\n    }\n  } catch (e) {\n    console.log('checkProof error:', e);\n  }\n}\n\n/**\n * Get account info\n *\n * @returns {Promise<{ balance: string; address: string }>}\n * @throws {Error}\n */\nexport async function getAccountInfo(): Promise<{\n  balance: string;\n  address: string;\n}> {\n  const response = await fetch(`${PUBLIC_API_URL}/api/account-info`, {\n    headers: {\n      Authorization: `Bearer ${cookie.get(ACCESS_TOKEN_COOKIE)}`,\n      'Content-Type': 'application/json'\n    }\n  });\n\n  if (!response.ok) {\n    throw new Error(response.statusText);\n  }\n\n  return await response.json();\n}\n\n/**\n * Reset the token\n */\nexport function removeAccessTokenCookie() {\n  cookie.remove(ACCESS_TOKEN_COOKIE);\n  generatePayload();\n}\n"],"names":["assign","target","i","source","key","defaultConverter","value","init","converter","defaultAttributes","set","name","attributes","stringifiedAttributes","attributeName","get","cookies","jar","parts","found","api","generatePayload","PUBLIC_API_URL","checkProof","proof","account","reqBody","response","cookie","ACCESS_TOKEN_COOKIE","COOKIE_EXPIRES","e","getAccountInfo","removeAccessTokenCookie"],"mappings":"qbAAA,6BAEA,SAASA,EAAQC,EAAQ,CACvB,QAASC,EAAI,EAAGA,EAAI,UAAU,OAAQA,IAAK,CACzC,IAAIC,EAAS,UAAUD,CAAC,EACxB,QAASE,KAAOD,EACdF,EAAOG,CAAG,EAAID,EAAOC,CAAG,CAE3B,CACD,OAAOH,CACT,CAIA,IAAII,EAAmB,CACrB,KAAM,SAAUC,EAAO,CACrB,OAAIA,EAAM,CAAC,IAAM,MACfA,EAAQA,EAAM,MAAM,EAAG,EAAE,GAEpBA,EAAM,QAAQ,mBAAoB,kBAAkB,CAC5D,EACD,MAAO,SAAUA,EAAO,CACtB,OAAO,mBAAmBA,CAAK,EAAE,QAC/B,2CACA,kBACD,CACF,CACH,EAKA,SAASC,EAAMC,EAAWC,EAAmB,CAC3C,SAASC,EAAKC,EAAML,EAAOM,EAAY,CACrC,GAAI,SAAO,SAAa,KAIxB,CAAAA,EAAaZ,EAAO,CAAA,EAAIS,EAAmBG,CAAU,EAEjD,OAAOA,EAAW,SAAY,WAChCA,EAAW,QAAU,IAAI,KAAK,KAAK,IAAG,EAAKA,EAAW,QAAU,KAAK,GAEnEA,EAAW,UACbA,EAAW,QAAUA,EAAW,QAAQ,YAAW,GAGrDD,EAAO,mBAAmBA,CAAI,EAC3B,QAAQ,uBAAwB,kBAAkB,EAClD,QAAQ,QAAS,MAAM,EAE1B,IAAIE,EAAwB,GAC5B,QAASC,KAAiBF,EACnBA,EAAWE,CAAa,IAI7BD,GAAyB,KAAOC,EAE5BF,EAAWE,CAAa,IAAM,KAWlCD,GAAyB,IAAMD,EAAWE,CAAa,EAAE,MAAM,GAAG,EAAE,CAAC,IAGvE,OAAQ,SAAS,OACfH,EAAO,IAAMH,EAAU,MAAMF,EAAOK,CAAI,EAAIE,EAC/C,CAED,SAASE,EAAKJ,EAAM,CAClB,GAAI,SAAO,SAAa,KAAgB,UAAU,QAAU,CAACA,GAQ7D,SAFIK,EAAU,SAAS,OAAS,SAAS,OAAO,MAAM,IAAI,EAAI,GAC1DC,EAAM,CAAA,EACDf,EAAI,EAAGA,EAAIc,EAAQ,OAAQd,IAAK,CACvC,IAAIgB,EAAQF,EAAQd,CAAC,EAAE,MAAM,GAAG,EAC5BI,EAAQY,EAAM,MAAM,CAAC,EAAE,KAAK,GAAG,EAEnC,GAAI,CACF,IAAIC,EAAQ,mBAAmBD,EAAM,CAAC,CAAC,EAGvC,GAFAD,EAAIE,CAAK,EAAIX,EAAU,KAAKF,EAAOa,CAAK,EAEpCR,IAASQ,EACX,KAEV,MAAkB,CAAE,CACf,CAED,OAAOR,EAAOM,EAAIN,CAAI,EAAIM,EAC3B,CAED,OAAO,OAAO,OACZ,CACE,IAAAP,EACA,IAAAK,EACA,OAAQ,SAAUJ,EAAMC,EAAY,CAClCF,EACEC,EACA,GACAX,EAAO,CAAE,EAAEY,EAAY,CACrB,QAAS,EACrB,CAAW,CACX,CACO,EACD,eAAgB,SAAUA,EAAY,CACpC,OAAOL,EAAK,KAAK,UAAWP,EAAO,CAAA,EAAI,KAAK,WAAYY,CAAU,CAAC,CACpE,EACD,cAAe,SAAUJ,EAAW,CAClC,OAAOD,EAAKP,EAAO,GAAI,KAAK,UAAWQ,CAAS,EAAG,KAAK,UAAU,CACnE,CACF,EACD,CACE,WAAY,CAAE,MAAO,OAAO,OAAOC,CAAiB,CAAG,EACvD,UAAW,CAAE,MAAO,OAAO,OAAOD,CAAS,CAAG,CAC/C,CACF,CACH,CAEA,IAAIY,EAAMb,EAAKF,EAAkB,CAAE,KAAM,GAAG,CAAE,ECxH9C,eAAsBgB,GAA4D,CAC5E,GAAA,CAMK,MAAA,CAAE,UALQ,MACf,MAAM,MAAM,GAAGC,CAAc,8BAA+B,CAC1D,OAAQ,MAAA,CACT,GACD,KAAK,GACqB,WAAqB,MAC3C,CACC,OAAA,IACT,CACF,CAUsB,eAAAC,EACpBC,EACAC,EACe,CACX,GAAA,CACF,MAAMC,EAAU,CACd,QAASD,EAAQ,QACjB,QAASA,EAAQ,MACjB,WAAYA,EAAQ,UACpB,MAAO,CACL,GAAGD,EACH,WAAYC,EAAQ,eACtB,CAAA,EAGIE,EAAW,MACf,MAAM,MAAM,GAAGL,CAAc,mBAAoB,CAC/C,OAAQ,OACR,KAAM,KAAK,UAAUI,CAAO,EAC5B,QAAS,CACP,eAAgB,kBAClB,CAAA,CACD,GACD,KAAK,EAEHC,GAAA,MAAAA,EAAU,OACLC,EAAA,IAAIC,EAAqBF,EAAS,MAAO,CAC9C,QAASG,EACT,SAAU,KAAA,CACX,QAEIC,EAAG,CACF,QAAA,IAAI,oBAAqBA,CAAC,CACpC,CACF,CAQA,eAAsBC,GAGnB,CACD,MAAML,EAAW,MAAM,MAAM,GAAGL,CAAc,oBAAqB,CACjE,QAAS,CACP,cAAe,UAAUM,EAAO,IAAIC,CAAmB,CAAC,GACxD,eAAgB,kBAClB,CAAA,CACD,EAEG,GAAA,CAACF,EAAS,GACN,MAAA,IAAI,MAAMA,EAAS,UAAU,EAG9B,OAAA,MAAMA,EAAS,MACxB,CAKO,SAASM,GAA0B,CACxCL,EAAO,OAAOC,CAAmB,EACjBR,GAClB"}