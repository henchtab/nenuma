{"version":3,"file":"BrokerAPI.k-MDxDlJ.js","sources":["../../../../../../src/routes/playground/options-api/components/BrokerAPI.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { Button } from '$lib/components/ui/button';\n  import { Input } from '$lib/components/ui/input';\n  import { Label } from '$lib/components/ui/label';\n  import { formatOutputDate } from '$lib/utils';\n  import { useBroker } from '$lib/wrappers';\n  import { fromNano, toNano } from '@ton/core';\n  import { toast } from 'svelte-sonner';\n  import { derived, writable } from 'svelte/store';\n  import Output from '../../components/Output.svelte';\n  import Section from './Section.svelte';\n\n  const brokerAddress = writable('');\n  const broker = useBroker(brokerAddress);\n\n  const shouldDisableActions = derived([brokerAddress], ([$brokerAddress]) => !$brokerAddress);\n\n  let output = $state<{ date: string; message: string }[]>([]);\n\n  async function handleOptionAddressSubmit(\n    e: SubmitEvent & {\n      currentTarget: EventTarget & HTMLFormElement;\n    }\n  ) {\n    e.preventDefault();\n\n    const formData = new FormData(e.currentTarget);\n    const optionId = BigInt(formData.get('optionId') as string);\n\n    const optionAddress = await $broker.getOptionAddress(optionId);\n\n    output.unshift({\n      date: formatOutputDate(new Date()),\n      message: JSON.stringify(\n        optionAddress.toString({\n          testOnly: true,\n          bounceable: false\n        }),\n        null,\n        2\n      )\n    });\n  }\n</script>\n\n<Section title=\"Broker\">\n  <Label class=\"grid gap-2 mt-4\">\n    Broker Address\n    <Input\n      type=\"text\"\n      placeholder=\"0QDCiYqpPo9esMDX35_BWYcsR1NKS7lbnPcPF6IMH8MNx2Lj\"\n      class=\"w-fit\"\n      bind:value={$brokerAddress}\n    />\n  </Label>\n  <p class=\"mt-3 mb-8 text-ds-gray-900 max-w-[640px]\">\n    Handles brokers and cash-or-nothing options. Sets up options, checks agreements, and ensures\n    enough deposit. Manages deposits and withdrawals, handles deployments, payouts, and\n    notifications for options settling in, out, or at the money. Keeps track of balances and sends\n    success messages to the right folks.\n  </p>\n  <div class=\"flex gap-4 items-end overflow-x-auto snap-x snap-mandatory pb-6\">\n    <a\n      class=\"snap-start\"\n      href={$shouldDisableActions\n        ? undefined\n        : `/playground/options-api/deploy?contract=brokerDeposit&title=${encodeURIComponent('Deposit Broker')}&forceTitle=true&broker=${$brokerAddress}`}\n    >\n      <Button\n        class=\"bg-ds-teal-800 hover:bg-ds-teal-700 text-white\"\n        disabled={$shouldDisableActions}>Deposit</Button\n      >\n    </a>\n\n    <Button\n      class=\"snap-start bg-ds-teal-800 hover:bg-ds-teal-700 text-white\"\n      disabled={$shouldDisableActions}\n      onclick={async () => await $broker.withdraw({ queryId: BigInt(Date.now()) })}\n    >\n      Withdraw\n    </Button>\n\n    <a\n      class=\"snap-start\"\n      href={$shouldDisableActions\n        ? undefined\n        : `/playground/options-api/deploy?contract=brokerOption&title=${encodeURIComponent('Cash-or-Nothing Option')}&broker=${$brokerAddress}`}\n    >\n      <Button\n        class=\"bg-ds-teal-800 hover:bg-ds-teal-700 text-white\"\n        disabled={$shouldDisableActions}>Deploy Option</Button\n      >\n    </a>\n\n    <Button\n      class=\"bg-ds-blue-800 text-white hover:bg-ds-blue-700 snap-start\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        const result = await $broker.getBalance();\n        output.unshift({\n          date: formatOutputDate(new Date()),\n          message: JSON.stringify(`${fromNano(result)} TON`, null, 2)\n        });\n      }}>Get Balance</Button\n    >\n\n    <Button\n      class=\"bg-ds-blue-800 text-white hover:bg-ds-blue-700 snap-start\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        const result = await $broker.getOwner();\n        output.unshift({\n          date: formatOutputDate(new Date()),\n          message: JSON.stringify(result.toString({ testOnly: true, bounceable: false }), null, 2)\n        });\n      }}>Get Owner</Button\n    >\n\n    <form class=\"flex flex-col gap-4 w-max snap-start\" onsubmit={handleOptionAddressSubmit}>\n      <div class=\"grid gap-2\">\n        <Label for=\"optionId\">Option ID</Label>\n        <Input type=\"number\" name=\"optionId\" id=\"optionId\" placeholder=\"777\" required min=\"0\" />\n      </div>\n\n      <Button\n        type=\"submit\"\n        disabled={$shouldDisableActions}\n        class=\"bg-ds-blue-800 text-white hover:bg-ds-blue-700\">Get Option Address</Button\n      >\n    </form>\n\n    <Button\n      class=\"bg-ds-blue-800 snap-start text-white hover:bg-ds-blue-700\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        const result = await $broker.getNextOptionId();\n        output.unshift({\n          date: formatOutputDate(new Date()),\n          message: JSON.stringify(result.toString(), null, 2)\n        });\n      }}>Get Next Option ID</Button\n    >\n\n    <Button\n      class=\"bg-ds-blue-800 snap-start text-white hover:bg-ds-blue-700\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        const result = await $broker.getStream();\n        output.unshift({\n          date: formatOutputDate(new Date()),\n          message: JSON.stringify(result.toString({ testOnly: true }), null, 2)\n        });\n      }}>Get Stream</Button\n    >\n\n    <Button\n      class=\"bg-ds-blue-800 snap-start text-white hover:bg-ds-blue-700\"\n      disabled={$shouldDisableActions}\n      onclick={async () => {\n        const result = await $broker.getPayout();\n        output.unshift({\n          date: formatOutputDate(new Date()),\n          message: JSON.stringify(\n            {\n              nominator: result.nominator.toString(),\n              denominator: result.denominator.toString()\n            },\n            null,\n            2\n          )\n        });\n      }}>Get Payout Coefficient</Button\n    >\n  </div>\n\n  <Output bind:output />\n</Section>\n"],"names":["brokerAddress","writable","broker","useBroker","shouldDisableActions","derived","$brokerAddress","output","$.source","$.proxy","handleOptionAddressSubmit","e","formData","optionId","optionAddress","$broker","formatOutputDate","$.template_effect","$.set_attribute","a","$shouldDisableActions","a_1","result","$.get","fromNano"],"mappings":";;;2cAYQA,EAAgBC,GAAS,EAAE,EAC3BC,EAASC,GAAUH,CAAa,EAEhCI,EAAuBC,GAAS,CAAAL,CAAa,EAAK,CAAA,CAAAM,CAAc,KAAOA,CAAc,EAEvF,IAAAC,EAAAC,GAAAC,EAAA,CAAA,CAAA,CAAA,iBAEWC,EACbC,EAAA,CAIAA,EAAE,eAAA,QAEIC,EAAe,IAAA,SAASD,EAAE,aAAa,EACvCE,EAAW,OAAOD,EAAS,IAAI,UAAU,CAAA,EAEzCE,EAAsB,MAAAC,EAAA,EAAQ,iBAAiBF,CAAQ,IAE7DN,CAAO,EAAA,QAAA,CACL,KAAMS,EAAqB,IAAA,IAAA,EAC3B,QAAS,KAAK,UACZF,EAAc,SAAA,CACZ,SAAU,GACV,WAAY,KAEd,KACA,CAAA,qQAaUR,EAAc,+FAYpBW,EAAA,IAAAC,EAAAC,EAAA,OAAAC,IACF,OAC+D,+DAAA,mBAAmB,gBAAgB,4BAA4Bd,EAAc,CAAA,EAAA,CAAA,+FAIpIc,EAAqB,4KAMvBA,EAAqB,0BACJL,EAAO,EAAC,SAAW,CAAA,QAAS,OAAO,KAAK,IAAG,CAAA,EAAA,8EAOhEE,EAAA,IAAAC,EAAAG,EAAA,OAAAD,IACF,OAC8D,8DAAA,mBAAmB,wBAAwB,YAAYd,EAAc,CAAA,EAAA,CAAA,+FAI3Hc,EAAqB,4KAMvBA,EAAqB,2BAEvBE,EAAM,MAASP,EAAO,EAAC,WAAU,EACvCQ,EAAAhB,CAAM,EAAC,QAAO,CACZ,KAAMS,EAAgB,IAAK,IAAI,EAC/B,QAAS,KAAK,UAAS,GAAIQ,GAAAA,SAASF,CAAM,CAAA,OAAS,KAAM,CAAC,8KAOpDF,EAAqB,2BAEvBE,EAAM,MAASP,EAAO,EAAC,SAAQ,EACrCQ,EAAAhB,CAAM,EAAC,QAAO,CACZ,KAAMS,EAAgB,IAAK,IAAI,EAC/B,QAAS,KAAK,UAAUM,EAAO,SAAQ,CAAG,SAAU,GAAM,WAAY,EAAK,CAAK,EAAA,KAAM,CAAC,kVAa/EF,EAAqB,mOAOvBA,EAAqB,2BAEvBE,EAAM,MAASP,EAAO,EAAC,gBAAe,EAC5CQ,EAAAhB,CAAM,EAAC,QAAO,CACZ,KAAMS,EAAgB,IAAK,IAAI,EAC/B,QAAS,KAAK,UAAUM,EAAO,SAAQ,EAAI,KAAM,CAAC,8KAO5CF,EAAqB,2BAEvBE,EAAM,MAASP,EAAO,EAAC,UAAS,EACtCQ,EAAAhB,CAAM,EAAC,QAAO,CACZ,KAAMS,EAAgB,IAAK,IAAI,EAC/B,QAAS,KAAK,UAAUM,EAAO,SAAQ,CAAG,SAAU,EAAS,CAAA,EAAA,KAAM,CAAC,8KAO9DF,EAAqB,2BAEvBE,EAAM,MAASP,EAAO,EAAC,UAAS,EACtCQ,EAAAhB,CAAM,EAAC,QAAO,CACZ,KAAMS,EAAgB,IAAK,IAAI,EAC/B,QAAS,KAAK,WAEV,UAAWM,EAAO,UAAU,SAAQ,EACpC,YAAaA,EAAO,YAAY,SAAQ,GAE1C,KACA,4JAlDqDZ,EAAyB,EAAA"}